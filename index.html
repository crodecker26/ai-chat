<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Partner Chat (Free Test)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 10px;
    }
    #chat {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
    }
    .user { color: blue; margin: 5px 0; }
    .ai { color: green; margin: 5px 0; }
    textarea { width: 100%; height: 60px; }
    button { width: 100%; padding: 10px; margin-top: 5px; }
  </style>
</head>
<body>

<h2>AI Partner Chat (Test Mode)</h2>

<div id="chat"></div>

<form id="chatForm" target="hidden_iframe" method="POST" action="https://script.google.com/macros/s/AKfycbzrwZK4-fff25HxYyNm77jvzHtKgJi0ewTjYx4iIAwrpo5yD5iDIp3s2A8lafwnzjSn/exec">
  <textarea name="data" id="msg" placeholder='{"user_id":"test_user","user_message":""}'></textarea>
  <button type="submit" onclick="prepareMessage()">Send</button>
</form>

<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = sender;
  div.textContent = text;
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
}

function prepareMessage() {
  const msgBox = document.getElementById("msg");
  const message = msgBox.value.trim();
  if (!message) return false; // prevent sending empty

  // Show in chat immediately
  addMessage("You: " + message, "user");
  addMessage("AI: (Message sent, Zapier will respond)", "ai");

  // Put JSON string into textarea for form POST
  msgBox.value = JSON.stringify({
    user_id: "test_user",
    user_message: message
  });

  // Clear textarea after short delay so user sees typing area ready
  setTimeout(() => { msgBox.value = ""; }, 100);

  return true;
}
</script>

</body>
</html>
